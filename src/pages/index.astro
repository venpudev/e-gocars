---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/hero-slider/Hero';
import Brand from '../components/banner-brand/Brand.astro';
import Testimonials from '../components/testimonials/Testimonials.astro';
// Ya no necesitamos el componente de autos destacados aquí para mantenerla simple
---

<Layout title="E-GoCars - Compra y Vende tu Auto con Confianza">
  
  <Hero client:load/>

  <section class="py-20 bg-gray-900">
    <div class="max-w-4xl mx-auto px-4">
      
      <div class="text-center mb-12">
        <h2 class="text-4xl font-bold text-white mb-4">¡Da el primer paso!</h2>
        <p class="text-lg text-gray-300">Completa el formulario y un especialista de E-GoCars te contactará.</p>
      </div>

      <div class="bg-gray-800 p-8 md:p-12 rounded-2xl shadow-2xl border border-gray-700">
        
        <form id="home-form" class="space-y-6">
          <div class="grid grid-cols-3 gap-3 text-center">
            <label class="relative">
              <input type="radio" name="interest" value="Comprar" class="peer sr-only" checked>
              <div class="p-4 rounded-lg bg-gray-700 cursor-pointer text-white peer-checked:bg-amber-500 peer-checked:text-black font-semibold transition-all">Comprar</div>
            </label>
            <label class="relative">
              <input type="radio" name="interest" value="Vender" class="peer sr-only">
              <div class="p-4 rounded-lg bg-gray-700 cursor-pointer text-white peer-checked:bg-amber-500 peer-checked:text-black font-semibold transition-all">Vender</div>
            </label>
            <label class="relative">
              <input type="radio" name="interest" value="Consignar" class="peer sr-only">
              <div class="p-4 rounded-lg bg-gray-700 cursor-pointer text-white peer-checked:bg-amber-500 peer-checked:text-black font-semibold transition-all">Consignar</div>
            </label>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <label for="name-home" class="block text-sm font-semibold text-white">Nombre</label>
              <input type="text" id="name-home" name="name" required placeholder="Tu nombre completo" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500"/>
            </div>
            <div class="space-y-2">
              <label for="phone-home" class="block text-sm font-semibold text-white">Teléfono</label>
              <input type="tel" id="phone-home" name="phone" required placeholder="+56 9 1234 5678" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500"/>
            </div>
          </div>
          <div class="space-y-2">
            <label for="message-home" class="block text-sm font-semibold text-white">Mensaje Adicional</label>
            <textarea id="message-home" name="message" rows="4" required placeholder="Ej: Busco un Mazda 3, quiero vender mi Ford Ranger, etc." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 resize-none"></textarea>
          </div>
          
          <div id="form-status-home" class="hidden" aria-live="polite"><p class="text-center font-medium p-3 rounded-lg"></p></div>

          <button type="submit" class="w-full bg-amber-500 hover:bg-amber-600 text-black font-bold py-4 px-8 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg text-lg">
            Contactar a un Ejecutivo
          </button>
        </form>
      </div>
    </div>
  </section>

  <Testimonials />
  <Brand />
</Layout>

<script>
  const form = document.getElementById("home-form") as HTMLFormElement | null;
  const formStatus = document.getElementById("form-status-home") as HTMLDivElement | null;
  const statusText = formStatus?.querySelector("p") as HTMLParagraphElement | null;

  async function handleSubmit(event: Event) {
    event.preventDefault();
    if (!form || !formStatus || !statusText) return;

    const formData = new FormData(event.target as HTMLFormElement);
    const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement | null;
    const originalButtonText = submitButton?.textContent || 'Contactar a un Ejecutivo';

    if (submitButton) {
        submitButton.disabled = true;
        submitButton.textContent = 'Enviando...';
    }

    try {
      const response = await fetch("https://formspree.io/f/xkgzdnnq", { // La misma URL de Formspree
        method: "POST",
        body: formData,
        headers: {
            'Accept': 'application/json'
        }
      });

      if (response.ok) {
        statusText.textContent = "¡Gracias! Tu mensaje ha sido enviado.";
        formStatus.className = 'text-green-700 bg-green-100 border border-green-200 p-3 rounded-lg';
        formStatus.classList.remove('hidden');
        form.reset();
      } else {
        throw new Error('Error en la respuesta del servidor');
      }
    } catch (error) {
      statusText.textContent = "Hubo un error al enviar el mensaje. Intenta de nuevo.";
      formStatus.className = 'text-red-700 bg-red-100 border border-red-200 p-3 rounded-lg';
      formStatus.classList.remove('hidden');
    } finally {
        if (submitButton) {
            submitButton.disabled = false;
            submitButton.textContent = originalButtonText;
        }
        setTimeout(() => {
            formStatus?.classList.add('hidden');
        }, 5000);
    }
  }
  form?.addEventListener("submit", handleSubmit);
</script>